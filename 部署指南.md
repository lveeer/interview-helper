# Docker Compose ä¸€é”®éƒ¨ç½²æŒ‡å—

## ğŸ“‹ å‰ç½®è¦æ±‚

ç¡®ä¿ä½ çš„ç³»ç»Ÿå·²å®‰è£…ï¼š
- Docker (ç‰ˆæœ¬ 20.10+)
- Docker Compose (ç‰ˆæœ¬ 2.0+)

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. é…ç½®ç¯å¢ƒå˜é‡

å¤åˆ¶ç¯å¢ƒå˜é‡ç¤ºä¾‹æ–‡ä»¶å¹¶ä¿®æ”¹é…ç½®ï¼š

```bash
cp .env.example .env
```

ç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œé…ç½®ä»¥ä¸‹å…³é”®å‚æ•°ï¼š

```bash
# å¿…é¡»é…ç½®çš„ API å¯†é’¥ï¼ˆè‡³å°‘é…ç½®ä¸€ä¸ªï¼‰
LITELLM_API_KEY=your-dashscope-api-key  # é€šä¹‰åƒé—®
# æˆ–
OPENAI_API_KEY=your-openai-api-key      # OpenAI
# æˆ–
IFLOW_API_KEY=your-iflow-api-key        # iFlow

# æ•°æ®åº“å¯†ç ï¼ˆå»ºè®®ä¿®æ”¹ï¼‰
POSTGRES_PASSWORD=interview123

# JWT å¯†é’¥ï¼ˆå¿…é¡»ä¿®æ”¹ï¼‰
SECRET_KEY=your-secret-key-change-this-in-production
```

### 2. ä¸€é”®å¯åŠ¨

```bash
# æ„å»ºå¹¶å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### 3. åˆå§‹åŒ–æ•°æ®åº“

é¦–æ¬¡å¯åŠ¨åï¼Œéœ€è¦è¿è¡Œæ•°æ®åº“è¿ç§»ï¼š

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec backend bash

# è¿è¡Œæ•°æ®åº“è¿ç§»
alembic upgrade head

# é€€å‡ºå®¹å™¨
exit
```

### 4. ä¸‹è½½ Ollama æ¨¡å‹

```bash
# ä¸‹è½½åµŒå…¥æ¨¡å‹
docker-compose exec ollama ollama pull mxbai-embed-large

# ä¸‹è½½ LLM æ¨¡å‹
docker-compose exec ollama ollama pull qwen2.5
```

## ğŸŒ è®¿é—®åº”ç”¨

å¯åŠ¨æˆåŠŸåï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **å‰ç«¯åº”ç”¨**: http://localhost
- **åç«¯ API**: http://localhost:8000
- **API æ–‡æ¡£**: http://localhost:8000/docs
- **æ•°æ®åº“**: localhost:5432
- **Redis**: localhost:6379
- **Ollama**: http://localhost:11434

## ğŸ› ï¸ å¸¸ç”¨å‘½ä»¤

### æœåŠ¡ç®¡ç†

```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# åœæ­¢æ‰€æœ‰æœåŠ¡
docker-compose down

# åœæ­¢å¹¶åˆ é™¤æ‰€æœ‰æ•°æ®å·ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰
docker-compose down -v

# é‡å¯æœåŠ¡
docker-compose restart

# é‡å¯ç‰¹å®šæœåŠ¡
docker-compose restart backend
```

### æŸ¥çœ‹æ—¥å¿—

```bash
# æŸ¥çœ‹æ‰€æœ‰æœåŠ¡æ—¥å¿—
docker-compose logs -f

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
docker-compose logs -f backend
docker-compose logs -f frontend
docker-compose logs -f postgres
```

### è¿›å…¥å®¹å™¨

```bash
# è¿›å…¥åç«¯å®¹å™¨
docker-compose exec backend bash

# è¿›å…¥æ•°æ®åº“å®¹å™¨
docker-compose exec postgres psql -U interview -d interview_helper

# è¿›å…¥ Ollama å®¹å™¨
docker-compose exec ollama bash
```

### æ•°æ®åº“æ“ä½œ

```bash
# æŸ¥çœ‹æ•°æ®åº“è¿ç§»çŠ¶æ€
docker-compose exec backend alembic current

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
docker-compose exec backend alembic downgrade -1

# åˆ›å»ºæ–°çš„è¿ç§»
docker-compose exec backend alembic revision --autogenerate -m "æè¿°"
```

## ğŸ“¦ æœåŠ¡æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯      â”‚  (Nginx, ç«¯å£ 80)
â”‚  (Vue 3)    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   åç«¯      â”‚  (FastAPI, ç«¯å£ 8000)
â”‚  (Python)   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â–¼            â–¼            â–¼            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚PostgreSQLâ”‚ â”‚  Redis   â”‚ â”‚  Ollama  â”‚ â”‚  Uploads â”‚
â”‚  (5432)  â”‚ â”‚  (6379)  â”‚ â”‚  (11434) â”‚ â”‚  (Volume)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ æ•…éšœæ’æŸ¥

### æœåŠ¡å¯åŠ¨å¤±è´¥

```bash
# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs backend

# æ£€æŸ¥æœåŠ¡å¥åº·çŠ¶æ€
docker-compose ps
```

### æ•°æ®åº“è¿æ¥å¤±è´¥

```bash
# æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å°±ç»ª
docker-compose exec postgres pg_isready -U interview

# æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres
```

### Ollama æ¨¡å‹æœªä¸‹è½½

```bash
# æ£€æŸ¥å·²å®‰è£…çš„æ¨¡å‹
docker-compose exec ollama ollama list

# é‡æ–°ä¸‹è½½æ¨¡å‹
docker-compose exec ollama ollama pull mxbai-embed-large
docker-compose exec ollama ollama pull qwen2.5
```

### ç«¯å£å†²çª

å¦‚æœç«¯å£å·²è¢«å ç”¨ï¼Œä¿®æ”¹ `docker-compose.yml` ä¸­çš„ç«¯å£æ˜ å°„ï¼š

```yaml
services:
  postgres:
    ports:
      - "5433:5432"  # æ”¹ä¸º 5433
```

## ğŸ“Š æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰æ•°æ®éƒ½å­˜å‚¨åœ¨ Docker Volume ä¸­ï¼š

- `postgres_data`: PostgreSQL æ•°æ®
- `redis_data`: Redis æ•°æ®
- `ollama_data`: Ollama æ¨¡å‹
- `backend_uploads`: ä¸Šä¼ æ–‡ä»¶
- `backend_logs`: åº”ç”¨æ—¥å¿—

### å¤‡ä»½æ•°æ®

```bash
# å¤‡ä»½ PostgreSQL
docker-compose exec postgres pg_dump -U interview interview_helper > backup.sql

# æ¢å¤ PostgreSQL
cat backup.sql | docker-compose exec -T postgres psql -U interview interview_helper
```

## ğŸ” å®‰å…¨å»ºè®®

1. **ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä¿®æ”¹é»˜è®¤å¯†ç **
   - ä¿®æ”¹ `POSTGRES_PASSWORD`
   - ä¿®æ”¹ `SECRET_KEY`

2. **é…ç½® HTTPS**
   - ä½¿ç”¨ Nginx åå‘ä»£ç†é…ç½® SSL è¯ä¹¦
   - æˆ–ä½¿ç”¨ Traefik è‡ªåŠ¨é…ç½® HTTPS

3. **é™åˆ¶ç½‘ç»œè®¿é—®**
   - åœ¨é˜²ç«å¢™ä¸­åªå¼€æ”¾å¿…è¦ç«¯å£
   - æ•°æ®åº“å’Œ Redis ä¸æš´éœ²åˆ°å¤–ç½‘

4. **å®šæœŸå¤‡ä»½æ•°æ®**
   - è®¾ç½®å®šæ—¶ä»»åŠ¡å¤‡ä»½æ•°æ®åº“
   - å¤‡ä»½ä¸Šä¼ æ–‡ä»¶å’Œæ—¥å¿—

## ğŸ“ æ›´æ–°åº”ç”¨

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æ„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# è¿è¡Œæ•°æ®åº“è¿ç§»
docker-compose exec backend alembic upgrade head
```

## ğŸ†˜ è·å–å¸®åŠ©

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- åç«¯æ—¥å¿—: `docker-compose logs -f backend`
- å‰ç«¯æ—¥å¿—: `docker-compose logs -f frontend`
- æ•°æ®åº“æ—¥å¿—: `docker-compose logs -f postgres`
- Ollama æ—¥å¿—: `docker-compose logs -f ollama`